
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>ADC Thermistor Circuit and Lookup Table</title> 
<meta name="author" content="Stratify Labs, Inc">

<!-- Enable responsive viewport -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
<!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

<!-- Le styles -->
<link href="/assets/themes/twitter/bootstrap3/css/bootstrap.min.css" rel="stylesheet">
<script src="/assets/themes/twitter/bootstrap3/js/jquery-2.0.3.min.js"></script>
<script src="/assets/themes/twitter/bootstrap3/js/bootstrap.min.js"></script>
<link href="/assets/themes/twitter/bootstrap3/css/font-awesome.min.css" rel="stylesheet">
<link href="/assets/themes/twitter/css/style.css" rel="stylesheet">
<link href="/assets/themes/twitter/css/syntax.css" rel="stylesheet">
<script src="/assets/themes/twitter/js/application.js"></script>

<!-- Le fav and touch icons -->
<!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

<!-- atom & rss feed -->
<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
<link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

</head>
<body style="min-height: 200px; padding-top: 50px;">
	<header class="navbar navbar-default navbar-fixed-top bs-docs-nav" role="banner">
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<div class="navbar-header">
						<button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".menu-navbar-collapse">
							<span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span>
						</button>
						<a class="navbar-brand" href="/index.html">
							<img style="height: 22px;" src="/images/Stratify-Labs-Logo.svg" />
						</a>
					</div>

					<!-- Collect the nav links, forms, and other content for toggling -->
					<div class="collapse navbar-collapse menu-navbar-collapse" role="navigation">
						<ul class="nav navbar-nav">
							<li><a href="https://github.com/StratifyLabs"><i class="fa fa-code-fork"></i> Code</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</header>

	<a class="anchor" id="top"></a>


	<div class="content" id="content">
		


<div class="container">
	<div class="row" style="margin-top: 20px;">
		<div class="col-md-offset-1 col-md-7">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h1>
						ADC Thermistor Circuit and Lookup Table <small>Embedded Design</small>
					</h1>
				</div>
				<div class="panel-body">
					<p><img class="post_image" src="/images/thermistor-circuit.png" />
Thermistors are simple to integrate in embedded designs but their temperature 
response can be challenging to interpret.  A lookup table is a convenient way 
to convert a thermistor’s ADC reading to temperature.</p>

<p>A thermistor’s resistance varies with temperature.  As an example, assume T1 
in the circuit above to be part number NTCLE413E2103H400 from 
Vishay/Dale Inc. This thermistor has the resistive characteristics shown 
in the table below.  At cold temperatures, the resistance is very large 
but decreases non-linearly as temperature increases.</p>

<p><img class="post_image_tall" src="/images/resistance-temperature.png" /></p>

<p>The complete datasheet for the part referenced is available <a href="http://www.vishay.com/docs/29078/ntcle413.pdf">here</a>.  The 
voltage at the ADC input is calculated using a voltage divider:</p>

<p><img class="post_equation" src="/images/adc-thermistor-formula1.svg" /></p>

<p>When the T1 resistance is large, the voltage at the ADC input is close to 
zero.  As the thermistor gets warmer, the voltage gets closer to V1.  The 
transition, however, is non-linear.  This means for embedded firmware to 
interpret the ADC reading as a temperature, it needs to either calculate 
a complicated transfer function or approximate the temperature using a lookup 
table and linear extrapolation.</p>

<h2 id="lookup-tables">Lookup Tables</h2>

<p>A lookup table consists of two (or more) columns of data, in this case, a column 
for the voltage representing the output of the sensing circuit and a column for 
the temperature.</p>

<h2 id="creating-the-lookup-table">Creating the Lookup Table</h2>

<p>A spreadsheet program is an excellent tool to create (and update) the lookup 
table and can be designed to easily copy and paste as a data table in a C 
file.  The image below shows a screen shot of an example.  The highlighted 
portion can be directly copied and pasted into the code.</p>

<p><img class="post_image" src="/images/lookup-table-shot.png" /></p>

<p>(The source file for the above image can be downloaded from 
this <a href="https://dl.dropbox.com/u/33863234/CoActionOS/lookup-table-sheet.xlsx">link</a>.)</p>

<p>The table contains distinct points on the voltage temperature curve.  Linear 
extrapolation is used to estimate the temperature between the points.</p>

<h2 id="extrapolating-the-data">Extrapolating the Data</h2>

<p>To extrapolate the data between points, the firmware first needs to select two 
data points.  It must scan the values in the x-column and find the two values 
directly above and below the input.  The firmware then uses the point slope 
formula to extrapolate the temperature value.</p>

<p><img class="post_equation" src="/images/adc-thermistor-formula2.svg" /></p>

<p>The values x0, x1, y0, and y1 are taken from the lookup table.  The x value is 
the input from the ADC, and the y value is the temperature.  The code below 
implements a lookup table using floating point variables.</p>

<div class="highlight"><pre><code class="language-cpp" data-lang="cpp">#include &lt;stdint.h&gt;
#include &lt;stdio.h&gt;
 
typedef struct {
  float x;
  float y;
} dsp_lookup_f_t;
 
 
float dsp_lookup_f(const dsp_lookup_f_t * table, float x, int size){
  int i;
  float m;
  i = 0;
  while((i &lt; (size)) &amp;amp;&amp;amp; (x &gt; table[i].x) ){  //find the two points in the table to use
    i++;
  }
  if ( i == size ){   //make sure the point isn&#39;t past the end of the table
    return table[i-1].y;
  }
 
  if ( i == 0 ){  //make sure the point isn&#39;t before the beginning of the table
    return table[i].y;
  }
 
  m = (table[i].y - table[i-1].y) / ( table[i].x - table[i-1].x); //calculate the slope
  return m * (x - table[i].x) + table[i].y; //this is the solution to the point slope formula
}
 
#define TABLE_SIZE 17
//The table below is copied and pasted from the spreadsheet
dsp_lookup_f_t my_table[TABLE_SIZE] = {          
{ .x=  11839  ,  .y=  -40  },
{ .x=  16050  ,  .y=  -35  },
{ .x=  21385  ,  .y=  -30  },
{ .x=  27980  ,  .y=  -25  },
{ .x=  35921  ,  .y=  -20  },
{ .x=  45214  ,  .y=  -15  },
{ .x=  55761  ,  .y=  -10  },
{ .x=  67358  ,  .y=  -5  },
{ .x=  79703  ,  .y=  0  },
{ .x=  92422  ,  .y=  5  },
{ .x=  105128  ,  .y=  10  },
{ .x=  117450  ,  .y=  15  },
{ .x=  129084  ,  .y=  20  },
{ .x=  139810  ,  .y=  25  },
{ .x=  149497  ,  .y=  30  },
{ .x=  158097  ,  .y=  35  },
{ .x=  165626  ,  .y=  40  },
}  
 
void read_temp(void){
     uint16_t adc_sample;
     float temp;
     adc_sample = read_adc_temp_channel();
     temp = dsp_lookup_f(my_table, (float)adc_sample, TABLE_SIZE);
     printf(&quot;Temperature is %f\n&quot;, temp);
}</code></pre></div>

<h2 id="conclusion">Conclusion</h2>

<p>Thermistors are great to use in embedded designs because they come in a variety 
of shapes and sizes and are easy to interface with a microcontroller ADC input.  The 
main design challenge is interpreting the non-linear temperature response.  Taking 
the temperature response and creating a lookup table using a spreadsheet is a 
relatively easy way of getting the table in C code.  The firmware then just 
needs to use linear extrapolation to approximate the temperature between 
points in the lookup table.</p>


				</div>
			</div>

			
			<ul class="nav nav-pills">
				
				


  
     
    	<li><a href="/tags.html#embedded-ref">embedded <span class="badge">36</span></a></li>
     
    	<li><a href="/tags.html#adc-ref">adc <span class="badge">2</span></a></li>
     
    	<li><a href="/tags.html#lookup-table-ref">lookup-table <span class="badge">1</span></a></li>
     
    	<li><a href="/tags.html#c-ref">c <span class="badge">3</span></a></li>
     
    	<li><a href="/tags.html#programming-ref">programming <span class="badge">9</span></a></li>
    
  



			</ul>
			
			<div class="pagination">
				<center>
					 
						<a href="/embedded%20design%20tips/2013/10/02/Tips-A-FIFO-Buffer-Implementation" type="button" class="btn btn-primary"
							data-toggle="tooltip" data-placement="left" title="" data-original-title="Previous Post"
							>
							<i class="fa fa-arrow-left"></i>
						</a> 
					 
					<a href="/archive.html" type="button" class="btn btn-primary"
						data-toggle="tooltip" data-placement="top" title="" data-original-title="Archives"
						>
						<i class="fa fa-archive"></i>
					</a> 
					<a href="/categories.html" type="button" class="btn btn-primary"
						data-toggle="tooltip" data-placement="top" title="" data-original-title="Categories"
					>
						<i class="fa fa-folder-open"></i>
					</a> 
					 
						<a href="/embedded%20design%20tips/2013/10/04/Tips-An-Easy-to-Use-Digital-Filter" type="button" class="btn btn-primary"
							data-toggle="tooltip" data-placement="right" title="" data-original-title="Next Post"
							>
							<i class="fa fa-arrow-right"></i>
						</a>
					
				</center>
			</div>
				
		</div>
		<div class="col-md-3">
		

			<h3>Embedded Design Tips</h3>
			<ul class="nav nav-pills nav-stacked">
				
				
				


  
    
      
      	
      	<li class='tagged embedded gcc compiler macosx'><a href="/embedded%20design%20tips/2014/10/05/Tips-Building-and-Installing-a-Cortex-M4-Compiler-on-Mac-OS-X">Building and Installing a Cortex-M4 Compiler on Mac OS X</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded microcontroller arm cortex-m3 coaction'><a href="/embedded%20design%20tips/2014/05/03/Applications-without-MMU">Applications without an MMU</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged doxygen javascript bootstrap'><a href="/embedded%20design%20tips/2014/01/07/Tips-Integrating-Doxygen-and-Bootstrap">Integrating Doxygen and Bootstrap</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded circuit'><a href="/embedded%20design%20tips/2013/10/27/Tips-Using-Op-Amps-in-Embedded-Design">Using Op Amps in Embedded Design</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded control gpio'><a href="/embedded%20design%20tips/2013/10/26/Tips-Controlling-a-Solenoid">Controlling a Solenoid</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded gpio circuit microcontroller popular'><a href="/embedded%20design%20tips/2013/10/25/Tips-Using-Pull-Up-and-Pull-Down-Resistors">Using Pull-Up and Pull-Down Resistors</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded circuit led control'><a href="/embedded%20design%20tips/2013/10/24/Tips-Using-LEDs-in-Embedded-Designs">Using LEDs in Embedded Designs</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded c doxygen programming'><a href="/embedded%20design%20tips/2013/10/23/Tips-Using-Doxygen-with-C">Using Doxygen with C</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded usb programming microcontroller serial'><a href="/embedded%20design%20tips/2013/10/22/Tips-USB-Virtual-Serial-Port-Firmware">USB Virtual Serial Port Firmware</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded microcontroller gpio programming'><a href="/embedded%20design%20tips/2013/10/21/Tips-Understanding-Microcontroller-Pin-Input-Output-Modes">Understanding Microcontroller Pin Input/Output Modes</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded circuit sensor filter adc programming'><a href="/embedded%20design%20tips/2013/10/19/Tips-Sensing-the-Source-Current-in-an-Embedded-Application">Sensing the Source Current in an Embedded Application</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded c programming popular'><a href="/embedded%20design%20tips/2013/10/18/Tips-RAM-Flash-Usage-in-Embedded-C-Programs">RAM/Flash Usage in Embedded C Programs</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded control pwm pid motor programming circuit popular'><a href="/embedded%20design%20tips/2013/10/15/Tips-Motor-Control-using-PWM-and-PID">Motor Control using PWM and PID</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded microcontroller circuit'><a href="/embedded%20design%20tips/2013/10/14/Tips-How-Microcontrollers-Work">How Microcontrollers Work</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded cortex-m3 fft filter popular'><a href="/embedded%20design%20tips/2013/10/13/Tips-FFT-on-the-ARM-Cortex-M3">FFT on the ARM Cortex M3</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded cortex-m3'><a href="/embedded%20design%20tips/2013/10/12/Tips-Effective-Use-of-ARM-Cortex-M3-SVCall">Effective Use of ARM Cortex-M3 SVCall</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded macosx qt'><a href="/embedded%20design%20tips/2013/10/11/Tips-Deploying-Qt-Applications-on-Mac-OSX">Deploying Qt Applications on Mac OSX</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded circuit power popular'><a href="/embedded%20design%20tips/2013/10/10/Tips-Decoupling-Capacitors">Decoupling Capacitors (and Other Power Rules of Thumb)</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded cortex-m3 threads popular'><a href="/embedded%20design%20tips/2013/10/09/Tips-Context-Switching-on-the-Cortex-M3">Context Switching on the Cortex-M3</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded compiler gcc'><a href="/embedded%20design%20tips/2013/10/08/Tips-Building-and-Installing-Autotools">Building and Installing Autotools</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded gcc compiler linux'><a href="/embedded%20design%20tips/2013/10/07/Tips-Building-and-Installing-a-Cortex-M3-Compiler-on-Ubuntu">Building and Installing a Cortex-M3 Compiler on Ubuntu</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded gcc compiler macosx'><a href="/embedded%20design%20tips/2013/10/06/Tips-Building-and-Installing-a-Cortex-M3-Compiler-on-Mac-OS-X">Building and Installing a Cortex-M3 Compiler on Mac OS X</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded gcc compiler windows'><a href="/embedded%20design%20tips/2013/10/05/Tips-Building-and-Installing-a-Cortex-M3-Compiler-in-Windows">Building and Installing a Cortex-M3 Compiler in Windows</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded filter iir programming popular'><a href="/embedded%20design%20tips/2013/10/04/Tips-An-Easy-to-Use-Digital-Filter">An Easy-to-Use Digital Filter</a></li>
      	
      
    
  
    
      
      	
      	<li class='active tagged embedded adc lookup-table c programming'><a href="/embedded%20design%20tips/2013/10/03/Tips-ADC-Thermistor-Circuit-and-Lookup-Table" class="active">ADC Thermistor Circuit and Lookup Table</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded fifo uart serial microcontroller programming popular'><a href="/embedded%20design%20tips/2013/10/02/Tips-A-FIFO-Buffer-Implementation">A FIFO Buffer Implementation</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded microcontroller popular'><a href="/embedded%20design%20tips/2013/10/01/Tips-8-vs-16-vs-32-Bit-Microcontrollers">8 vs 16 vs 32 Bit Microcontrollers--A Case Study</a></li>
      	
      
    
  



			</ul>
			
			
				<h3>Embedded C Tutorial</h3>
				<ul class="nav nav-pills nav-stacked">
					  
					


  
    
      
      	
      	<li class='tagged embedded tutorial'><a href="/embedded%20c%20tutorial/2013/12/11/Embedded-C-Tutorial-Order-of-Operations">Order of Operations Reference</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded tutorial'><a href="/embedded%20c%20tutorial/2013/12/10/Embedded-C-Tutorial-Keyword-Reference">Keywords Reference</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded tutorial'><a href="/embedded%20c%20tutorial/2013/12/09/Embedded-C-Tutorial-Compound-Data-Types">Compound Data Types</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded tutorial'><a href="/embedded%20c%20tutorial/2013/12/08/Embedded-C-Tutorial-Preprocessor">Preprocessor Directives</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded tutorial'><a href="/embedded%20c%20tutorial/2013/12/07/Embedded-C-Tutorial-Pointers-and-Arrays">Pointers and Arrays</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded tutorial'><a href="/embedded%20c%20tutorial/2013/12/05/Embedded-C-Tutorial-Flow-Control">Flow Control</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded tutorial'><a href="/embedded%20c%20tutorial/2013/12/04/Embedded-C-Tutorial-Operators">Operators</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded tutorial'><a href="/embedded%20c%20tutorial/2013/12/03/Embedded-C-Tutorial-Raw-Types">Raw Types</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded tutorial'><a href="/embedded%20c%20tutorial/2013/12/02/Embedded-C-Tutorial-Functions">Functions</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged embedded tutorial popular'><a href="/embedded%20c%20tutorial/2013/12/01/Embedded-C-Tutorial-Hello-World">Hello World</a></li>
      	
      
    
  



				</ul>
			
			
			
			  
		</div>
	</div>

</div>



	</div>

	<footer style="background: #344555; color: #fff;">
		<div class="container">
			<div class="row" style="margin-top: 20px; margin-bottom: 20px; ">
				<div class="col-md-12">
					<p>&copy; 2016 Stratify Labs, Inc</p>
				</div>
			</div>
		</div>
	</footer>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-21543723-3', 'coactionos.com');
  ga('send', 'pageview');

</script>
 </body>
</html>

