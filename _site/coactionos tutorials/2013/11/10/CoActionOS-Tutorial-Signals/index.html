
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Signals Tutorial</title> 
<meta name="author" content="Stratify Labs, Inc">

<!-- Enable responsive viewport -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
<!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

<!-- Le styles -->
<link href="/assets/themes/twitter/bootstrap3/css/bootstrap.min.css" rel="stylesheet">
<script src="/assets/themes/twitter/bootstrap3/js/jquery-2.0.3.min.js"></script>
<script src="/assets/themes/twitter/bootstrap3/js/bootstrap.min.js"></script>
<link href="/assets/themes/twitter/bootstrap3/css/font-awesome.min.css" rel="stylesheet">
<link href="/assets/themes/twitter/css/style.css" rel="stylesheet">
<link href="/assets/themes/twitter/css/syntax.css" rel="stylesheet">
<script src="/assets/themes/twitter/js/application.js"></script>

<!-- Le fav and touch icons -->
<!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

<!-- atom & rss feed -->
<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
<link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

</head>
<body style="min-height: 200px; padding-top: 50px;">
	<header class="navbar navbar-default navbar-fixed-top bs-docs-nav" role="banner">
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<div class="navbar-header">
						<button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".menu-navbar-collapse">
							<span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span>
						</button>
						<a class="navbar-brand" href="/index.html">
							<img style="height: 22px;" src="/images/StratifyOS-Logo.svg" />
						</a>
					</div>

					<!-- Collect the nav links, forms, and other content for toggling -->
					<div class="collapse navbar-collapse menu-navbar-collapse" role="navigation">
						<ul class="nav navbar-nav">
							<li><a href="https://github.com/StratifyLabs"><i class="fa fa-code-fork"></i> Code</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</header>

	<a class="anchor" id="top"></a>


	<div class="content" id="content">
		


<div class="container">
	<div class="row" style="margin-top: 20px;">
		<div class="col-md-offset-1 col-md-7">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h1>
						Signals Tutorial <small>CoActionOS Tutorial</small>
					</h1>
				</div>
				<div class="panel-body">
					<p>CoActionOS allows uers signals to notify different threads or processes 
about events.  It uses POSIX signals as the underlying API.  CoActionOS 
Applib provides a class to easily send and receive signals.  When a thread 
or process receives a signal, its execution is interrupted and the signal 
handler is executed.  This is distinct from hardware interrupt handlers 
because the signal interrupt will not execute until the receiving task 
is scheduled to execute.  Also, hardware interrupts run in privileged 
mode where signal handlers run in user mode.</p>

<p>The example below shows how to send a signal using software as well 
as how to enable hardware to send a signal when an event happens.</p>

<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;applib/Timer.hpp&gt;</span>
<span class="cp">#include &lt;applib/Tmr.hpp&gt;</span>
<span class="cp">#include &lt;applib/Signal.hpp&gt;</span>

<span class="k">volatile</span> <span class="kt">bool</span> <span class="n">done</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">sigusr</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">){</span>
	<span class="n">done</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">software_trigger_example</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">hardware_trigger_example</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[]){</span>
	<span class="n">software_trigger_example</span><span class="p">();</span>
	<span class="n">hardware_trigger_example</span><span class="p">();</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">&quot;Both examples are complete</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="c1">//this function sets up a handler and triggers it with software</span>
<span class="kt">void</span> <span class="nf">software_trigger_example</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>
	<span class="n">Signal</span><span class="o">::</span><span class="n">Handler</span> <span class="n">handler</span><span class="p">(</span><span class="n">sigusr</span><span class="p">);</span> <span class="c1">//the function sigusr is called with this handler</span>
	<span class="n">Signal</span><span class="o">::</span><span class="n">Event</span> <span class="n">event</span><span class="p">(</span><span class="n">SIGUSR1</span><span class="p">);</span>
	<span class="n">event</span><span class="p">.</span><span class="n">set_handler</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handler</span><span class="p">);</span>
	<span class="n">done</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">event</span><span class="p">.</span><span class="n">trigger</span><span class="p">(</span><span class="n">getpid</span><span class="p">());</span> <span class="c1">//send the signal to this process</span>
	<span class="k">while</span><span class="p">(</span> <span class="o">!</span><span class="n">done</span> <span class="p">){</span>
		<span class="n">Timer</span><span class="o">::</span><span class="n">wait_usec</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">&quot;SIGUSR1 has been handled</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//this function sets up a handler and triggers it with hardware (such as a timer event)</span>
<span class="kt">void</span> <span class="nf">hardware_trigger_example</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>
	<span class="n">Tmr</span> <span class="n">tmr</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="c1">//use hardware tmr0 as the triggering mechanism</span>
	<span class="kt">tmr_action_t</span> <span class="n">action</span><span class="p">;</span>
	<span class="n">Signal</span><span class="o">::</span><span class="n">Handler</span> <span class="n">handler</span><span class="p">(</span><span class="n">sigusr</span><span class="p">);</span> <span class="c1">//the function sigusr is called with this handler</span>
	<span class="n">Signal</span><span class="o">::</span><span class="n">EventPhy</span> <span class="n">event</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span> <span class="n">SIGUSR1</span><span class="p">);</span>

	<span class="n">tmr</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span> <span class="c1">//tmr0 will run as a 1KHz timer</span>

	<span class="n">tmr</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="c1">//set timer to 0</span>
	<span class="n">tmr</span><span class="p">.</span><span class="n">setoc</span><span class="p">(</span><span class="n">TMR_ACTION_CHANNEL_OC0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span> <span class="c1">//set output compare 0 to 1000 (triggers after one second)</span>

	<span class="n">action</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="n">action</span><span class="p">(</span><span class="n">Tmr</span><span class="o">::</span><span class="n">INTERRUPT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">tmr</span><span class="p">.</span><span class="n">setaction</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">action</span> <span class="p">);</span>
	<span class="n">done</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">tmr</span><span class="p">.</span><span class="n">on</span><span class="p">();</span>
	<span class="k">while</span><span class="p">(</span> <span class="o">!</span><span class="n">done</span> <span class="p">){</span>
		<span class="n">Timer</span><span class="o">::</span><span class="n">wait_usec</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">printf</span><span class="p">(</span><span class="s">&quot;SIGUSR1 has been handled (triggered by tmr0)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>

				</div>
			</div>

			
			<ul class="nav nav-pills">
				
				


  
     
    	<li><a href="/tags.html#coaction-ref">coaction <span class="badge">22</span></a></li>
     
    	<li><a href="/tags.html#tutorial-ref">tutorial <span class="badge">22</span></a></li>
     
    	<li><a href="/tags.html#signals-ref">signals <span class="badge">1</span></a></li>
    
  



			</ul>
			
			<div class="pagination">
				<center>
					 
						<a href="/coactionos%20tutorials/2013/11/09/CoActionOS-Tutorial-AIO" type="button" class="btn btn-primary"
							data-toggle="tooltip" data-placement="left" title="" data-original-title="Previous Post"
							>
							<i class="fa fa-arrow-left"></i>
						</a> 
					 
					<a href="/archive.html" type="button" class="btn btn-primary"
						data-toggle="tooltip" data-placement="top" title="" data-original-title="Archives"
						>
						<i class="fa fa-archive"></i>
					</a> 
					<a href="/categories.html" type="button" class="btn btn-primary"
						data-toggle="tooltip" data-placement="top" title="" data-original-title="Categories"
					>
						<i class="fa fa-folder-open"></i>
					</a> 
					 
						<a href="/coactionos%20tutorials/2013/11/10/CoActionOS-Tutorial-Thread" type="button" class="btn btn-primary"
							data-toggle="tooltip" data-placement="right" title="" data-original-title="Next Post"
							>
							<i class="fa fa-arrow-right"></i>
						</a>
					
				</center>
			</div>
				
		</div>
		<div class="col-md-3">
		

			<h3>CoActionOS Tutorials</h3>
			<ul class="nav nav-pills nav-stacked">
				
				
				


  
    
      
      	
      	<li class='tagged coaction tutorial control threads'><a href="/coactionos%20tutorials/2013/11/11/CoActionOS-Tutorial-Motor-Control">Motor Control Tutorial</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged coaction tutorial'><a href="/coactionos%20tutorials/2013/11/10/CoActionOS-Tutorial-Thread">Thread Tutorial</a></li>
      	
      
    
  
    
      
      	
      	<li class='active tagged coaction tutorial signals'><a href="/coactionos%20tutorials/2013/11/10/CoActionOS-Tutorial-Signals" class="active">Signals Tutorial</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged coaction tutorial'><a href="/coactionos%20tutorials/2013/11/09/CoActionOS-Tutorial-AIO">AIO Tutorial</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged coaction tutorial'><a href="/coactionos%20tutorials/2013/11/08/CoActionOS-Tutorial-Strings">Strings Tutorial</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged coaction tutorial control pwm'><a href="/coactionos%20tutorials/2013/11/07/CoActionOS-Tutorial-Pwm">PWM Tutorial</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged coaction tutorial serial i2c'><a href="/coactionos%20tutorials/2013/11/06/CoActionOS-Tutorial-I2C">I2C Tutorial</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged coaction tutorial serial spi'><a href="/coactionos%20tutorials/2013/11/05/CoActionOS-Tutorial-Spi">SPI Tutorial</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged coaction tutorial serial uart'><a href="/coactionos%20tutorials/2013/11/04/CoActionOS-Tutorial-Uart">UART Tutorial</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged coaction tutorial'><a href="/coactionos%20tutorials/2013/11/03/CoActionOS-Tutorial-Files">Files Tutorial</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged coaction tutorial control'><a href="/coactionos%20tutorials/2013/11/02/CoActionOS-Tutorial-Pio">PIO Tutorial</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged coaction tutorial control popular'><a href="/coactionos%20tutorials/2013/11/01/CoActionOS-Tutorial-First-Project">First Project</a></li>
      	
      
    
  



			</ul>
			
			
			
			  
		</div>
	</div>

</div>



	</div>

	<footer style="background: #344555; color: #fff;">
		<div class="container">
			<div class="row" style="margin-top: 20px; margin-bottom: 20px; ">
				<div class="col-md-12">
					<p>&copy; 2016 Stratify Labs, Inc</p>
				</div>
			</div>
		</div>
	</footer>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-21543723-3', 'coactionos.com');
  ga('send', 'pageview');

</script>
 </body>
</html>

