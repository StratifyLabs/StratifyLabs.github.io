
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>AIO Tutorial</title> 
<meta name="author" content="Stratify Labs, Inc">

<!-- Enable responsive viewport -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
<!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

<!-- Le styles -->
<link href="/assets/themes/twitter/bootstrap3/css/bootstrap.min.css" rel="stylesheet">
<script src="/assets/themes/twitter/bootstrap3/js/jquery-2.0.3.min.js"></script>
<script src="/assets/themes/twitter/bootstrap3/js/bootstrap.min.js"></script>
<link href="/assets/themes/twitter/bootstrap3/css/font-awesome.min.css" rel="stylesheet">
<link href="/assets/themes/twitter/css/style.css" rel="stylesheet">
<link href="/assets/themes/twitter/css/syntax.css" rel="stylesheet">
<script src="/assets/themes/twitter/js/application.js"></script>

<!-- Le fav and touch icons -->
<!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

<!-- atom & rss feed -->
<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
<link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

</head>
<body style="min-height: 200px; padding-top: 50px;">
	<header class="navbar navbar-default navbar-fixed-top bs-docs-nav" role="banner">
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<div class="navbar-header">
						<button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".menu-navbar-collapse">
							<span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span>
						</button>
						<a class="navbar-brand" href="/index.html">
							<img style="height: 22px;" src="/images/Stratify-Labs-Logo.svg" />
						</a>
					</div>

					<!-- Collect the nav links, forms, and other content for toggling -->
					<div class="collapse navbar-collapse menu-navbar-collapse" role="navigation">
						<ul class="nav navbar-nav">
							<li><a href="https://github.com/StratifyLabs"><i class="fa fa-code-fork"></i> Code</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</header>

	<a class="anchor" id="top"></a>


	<div class="content" id="content">
		


<div class="container">
	<div class="row" style="margin-top: 20px;">
		<div class="col-md-offset-1 col-md-7">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h1>
						AIO Tutorial <small>CoActionOS Tutorial</small>
					</h1>
				</div>
				<div class="panel-body">
					<p>Asynchronous IO (AIO) is used when you want to start an operation and do 
other things while you wait until the operation completes. AIO is supported 
on all peripherals which support read() and write(). Simply pass an Aio 
object to read() or write(), and the operation will perform asynchronously.</p>

<p>The following program demonstrates AIO using the DAC. See the 
<a href="/coactionos-applib/html/class_aio.html">AIO class documenation</a> and 
<a href="/coactionos-applib/html/class_dac.html">DAC class documentation</a> for more details.</p>

<div class="highlight"><pre><code class="language-cpp" data-lang="cpp">#include &lt;applib/DbugStdout.hpp&gt; //For the DbugStdout class (or just use printf() is you prefer)
#include &lt;applib/Dac.hpp&gt; //For the DbugStdout class
#include &lt;applib/Aio.hpp&gt;
#include &lt;cmath&gt;
#include &lt;cstdio&gt; //for perror
 
#define NUM_SAMPLES 32
 
//This function generates a sin wave for use with the DAC
static void sin_to_dac(dac_sample_t * samples, int nsamples);
 
int main(int argc, char * argv[]){
  dac_sample_t samples[NUM_SAMPLES];
  Dac dac(0);
  DbugStdout d;
  int i;
  Aio aio(samples, NUM_SAMPLES*sizeof(dac_sample_t)); //this is the Aio object
 
  //Initialize the DAC
  if( dac.init(1&lt;&lt;0, 1000*NUM_SAMPLES) &lt; 0 ){ //enable channel 0 with 1KHz sine wave
    perror(&quot;failed to init&quot;);
    return -1;
  }
 
  //populate the samples with a sine wave
  sin_to_dac(samples, NUM_SAMPLES);
 
  for(i=0; i &lt; 100; i++){
 
    //this is a synchronous write -- does not return until write is complete
    dac.write(0, samples, NUM_SAMPLES*sizeof(dac_sample_t));
 
    //do an asynchronous write of the samples -- returns immediately
    dac.write(aio);
 
    //wait for the operation to complete
    while( aio.inprogress() == true ){
      usleep(2*1000);
    }
 
    //check for errors
    if( aio.ret() &lt; 0 ){
      errno = aio.error();
      perror(&quot;failed to complete write&quot;);
      exit(1);
    }
 
  }
  d &lt;&lt; &quot;Done\n&quot;;
  return 0;
}
 
 
void sin_to_dac(dac_sample_t * samples, int nsamples){
  int i;
  DbugStdout d;
  dac_sample_t sample;
  float tmp;
  for(i=0; i &lt; nsamples; i++){
    tmp = sin(i*2*M_PI/(nsamples)); //tmp is from -1 to 1
    samples[i] = (dac_sample_t)(tmp*DAC_MAX_VALUE/2 + DAC_MAX_VALUE/2);
    d &lt;&lt; samples[i] &lt;&lt; &quot;\n&quot;;
  }
}</code></pre></div>


				</div>
			</div>

			
			<ul class="nav nav-pills">
				
				


  
     
    	<li><a href="/tags.html#coaction-ref">coaction <span class="badge">22</span></a></li>
     
    	<li><a href="/tags.html#tutorial-ref">tutorial <span class="badge">22</span></a></li>
    
  



			</ul>
			
			<div class="pagination">
				<center>
					 
						<a href="/coactionos%20tutorials/2013/11/08/CoActionOS-Tutorial-Strings" type="button" class="btn btn-primary"
							data-toggle="tooltip" data-placement="left" title="" data-original-title="Previous Post"
							>
							<i class="fa fa-arrow-left"></i>
						</a> 
					 
					<a href="/archive.html" type="button" class="btn btn-primary"
						data-toggle="tooltip" data-placement="top" title="" data-original-title="Archives"
						>
						<i class="fa fa-archive"></i>
					</a> 
					<a href="/categories.html" type="button" class="btn btn-primary"
						data-toggle="tooltip" data-placement="top" title="" data-original-title="Categories"
					>
						<i class="fa fa-folder-open"></i>
					</a> 
					 
						<a href="/coactionos%20tutorials/2013/11/10/CoActionOS-Tutorial-Signals" type="button" class="btn btn-primary"
							data-toggle="tooltip" data-placement="right" title="" data-original-title="Next Post"
							>
							<i class="fa fa-arrow-right"></i>
						</a>
					
				</center>
			</div>
				
		</div>
		<div class="col-md-3">
		

			<h3>CoActionOS Tutorials</h3>
			<ul class="nav nav-pills nav-stacked">
				
				
				


  
    
      
      	
      	<li class='tagged coaction tutorial control threads'><a href="/coactionos%20tutorials/2013/11/11/CoActionOS-Tutorial-Motor-Control">Motor Control Tutorial</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged coaction tutorial'><a href="/coactionos%20tutorials/2013/11/10/CoActionOS-Tutorial-Thread">Thread Tutorial</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged coaction tutorial signals'><a href="/coactionos%20tutorials/2013/11/10/CoActionOS-Tutorial-Signals">Signals Tutorial</a></li>
      	
      
    
  
    
      
      	
      	<li class='active tagged coaction tutorial'><a href="/coactionos%20tutorials/2013/11/09/CoActionOS-Tutorial-AIO" class="active">AIO Tutorial</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged coaction tutorial'><a href="/coactionos%20tutorials/2013/11/08/CoActionOS-Tutorial-Strings">Strings Tutorial</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged coaction tutorial control pwm'><a href="/coactionos%20tutorials/2013/11/07/CoActionOS-Tutorial-Pwm">PWM Tutorial</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged coaction tutorial serial i2c'><a href="/coactionos%20tutorials/2013/11/06/CoActionOS-Tutorial-I2C">I2C Tutorial</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged coaction tutorial serial spi'><a href="/coactionos%20tutorials/2013/11/05/CoActionOS-Tutorial-Spi">SPI Tutorial</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged coaction tutorial serial uart'><a href="/coactionos%20tutorials/2013/11/04/CoActionOS-Tutorial-Uart">UART Tutorial</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged coaction tutorial'><a href="/coactionos%20tutorials/2013/11/03/CoActionOS-Tutorial-Files">Files Tutorial</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged coaction tutorial control'><a href="/coactionos%20tutorials/2013/11/02/CoActionOS-Tutorial-Pio">PIO Tutorial</a></li>
      	
      
    
  
    
      
      	
      	<li class='tagged coaction tutorial control popular'><a href="/coactionos%20tutorials/2013/11/01/CoActionOS-Tutorial-First-Project">First Project</a></li>
      	
      
    
  



			</ul>
			
			
			
			  
		</div>
	</div>

</div>



	</div>

	<footer style="background: #344555; color: #fff;">
		<div class="container">
			<div class="row" style="margin-top: 20px; margin-bottom: 20px; ">
				<div class="col-md-12">
					<p>&copy; 2016 Stratify Labs, Inc</p>
				</div>
			</div>
		</div>
	</footer>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-21543723-3', 'coactionos.com');
  ga('send', 'pageview');

</script>
 </body>
</html>

