
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>CoActionOS Docs</title> 
<meta name="author" content="Stratify Labs, Inc">

<!-- Enable responsive viewport -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
<!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

<!-- Le styles -->
<link href="/assets/themes/twitter/bootstrap3/css/bootstrap.min.css" rel="stylesheet">
<script src="/assets/themes/twitter/bootstrap3/js/jquery-2.0.3.min.js"></script>
<script src="/assets/themes/twitter/bootstrap3/js/bootstrap.min.js"></script>
<link href="/assets/themes/twitter/bootstrap3/css/font-awesome.min.css" rel="stylesheet">
<link href="/assets/themes/twitter/css/style.css" rel="stylesheet">
<link href="/assets/themes/twitter/css/syntax.css" rel="stylesheet">
<script src="/assets/themes/twitter/js/application.js"></script>

<!-- Le fav and touch icons -->
<!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

<!-- atom & rss feed -->
<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
<link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

</head>
<body style="min-height: 200px; padding-top: 50px;">
	<header class="navbar navbar-default navbar-fixed-top bs-docs-nav" role="banner">
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<div class="navbar-header">
						<button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".menu-navbar-collapse">
							<span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span>
						</button>
						<a class="navbar-brand" href="/index.html">
							<img style="height: 22px;" src="/images/Stratify-Labs-Logo.svg" />
						</a>
					</div>

					<!-- Collect the nav links, forms, and other content for toggling -->
					<div class="collapse navbar-collapse menu-navbar-collapse" role="navigation">
						<ul class="nav navbar-nav">
							<li><a href="https://github.com/StratifyLabs"><i class="fa fa-code-fork"></i> Code</a></li>
							<li><a href="/tips.html"><i class="fa fa-exclamation-circle"></i> Design Tips</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</header>

	<a class="anchor" id="top"></a>


	<div class="content" id="content">
		


<div class="container">
	<div class="row" style="margin-top: 20px;">
		<div class="col-md-offset-1 col-md-10">
			<div>
				
<script type="text/javascript" src="doxy-boot.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="style.css" rel="stylesheet" type="text/css" />
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a>  </div>
  <div class="headertitle">
<div class="title">Analog to Digital Converter (ADC)<div class="ingroups"><a class="el" href="group___p_e_r_i_p_h_i_o.html">Peripheral Input/Output</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for Analog to Digital Converter (ADC):</div>
<div class="dyncontent">
<center><table><tr><td><div class="center"><iframe scrolling="no" frameborder="0" src="group___a_d_c.svg" width="400" height="54"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</td></tr></table></center>
</div>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The ADC peripheral driver allows access to the MCU's built-in ADC. Each peripheral is opened using a unique port number and mode settings. Once open, any channel from the ADC can be read. Closing the peripheral will disable power to the ADC. More information about accessing peripheral IO is in the <a class="el" href="group___p_e_r_i_p_h_i_o.html">Peripheral Input/Output</a> section.</p>
<p>The following is an example of how to read the ADC in an OS environment:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fcntl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="adc_8h.html">dev/adc.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> read_adc(<span class="keywordtype">void</span>){</div>
<div class="line">     <span class="keywordtype">int</span> fd;</div>
<div class="line">     <a class="code" href="group___a_d_c.html#ga33301a686dfa6470fcd5ddae981e889f">adc_sample_t</a> buffer[16]; <span class="comment">//a buffer for 16 samples</span></div>
<div class="line">     <a class="code" href="structadc__attr__t.html">adc_attr_t</a> attr;</div>
<div class="line"></div>
<div class="line">     fd = <a class="code" href="group___u_n_i___f_i_l_e___a_c_c_e_s_s.html#gac843f2e35e60c3bbf1da47d84306f29b">open</a>(<span class="stringliteral">&quot;/dev/adc0&quot;</span>, O_RDWR);</div>
<div class="line">     <span class="keywordflow">if</span> ( fd &lt; 0 ){</div>
<div class="line">          printf(<span class="stringliteral">&quot;Error opening peripheral (%d)\n&quot;</span>, errno);</div>
<div class="line">     } <span class="keywordflow">else</span> {</div>
<div class="line">     attr.<a class="code" href="structadc__attr__t.html#a52ac5ff57cb395121181220492703e18">enabled_channels</a> = (1&lt;&lt;5); <span class="comment">//enabled channel five</span></div>
<div class="line">          attr.<a class="code" href="structadc__attr__t.html#a1b3d3fde33a659eaa407875721b2e80c">freq</a> = <a class="code" href="group___a_d_c.html#gaee9ff036d0e34f634b48e953d19d3bc2">ADC_MAX_FREQ</a>;</div>
<div class="line">          attr.<a class="code" href="structadc__attr__t.html#ac57e591ff27636cd38c89b788a3d1a1a">pin_assign</a> = 0;</div>
<div class="line">          <span class="keywordflow">if</span>( <a class="code" href="group___u_n_i___f_i_l_e___a_c_c_e_s_s.html#ga1e7463f2ee53d9da5a2ee24121aed25d">ioctl</a>(fd, <a class="code" href="group___a_d_c.html#gaf9007b82aa0f9af53bbb74796462927e">I_ADC_SETATTR</a>, &amp;ctl_adc) &lt; 0 ){</div>
<div class="line">               printf(<span class="stringliteral">&quot;Failed to set ADC configuration (%d)\n&quot;</span>, errno);</div>
<div class="line">               <span class="keywordflow">return</span> -1;</div>
<div class="line">     }</div>
<div class="line"></div>
<div class="line">     <span class="comment">//now read 16 samples of the ADC</span></div>
<div class="line">     <a class="code" href="group___u_n_i___f_i_l_d_e_s.html#ga33a233f3e6cc9e1a2b8b3f6aaea2c808">lseek</a>(fd, 5, SEEK_SET); <span class="comment">//this sets the channel to 5 -- it&#39;s a &#39;c&#39; device so it doesn&#39;t auto-increment</span></div>
<div class="line">     <span class="keywordflow">if</span> ( <a class="code" href="group___u_n_i___f_i_l_e___a_c_c_e_s_s.html#gaefe7609d91407014d94611912cc2b1a3">read</a>(fd, buffer, <span class="keyword">sizeof</span>(<a class="code" href="group___a_d_c.html#ga33301a686dfa6470fcd5ddae981e889f">adc_sample_t</a>)*16) &lt; 0 ){</div>
<div class="line">          printf(<span class="stringliteral">&quot;Error reading peripheral (%d)\n&quot;</span>, errno);</div>
<div class="line">          <span class="keywordflow">return</span> -1;</div>
<div class="line">     }</div>
<div class="line">     }</div>
<div class="line">     <a class="code" href="group___u_n_i___f_i_l_e___a_c_c_e_s_s.html#gaacad1d135ca2779b583623678e36db7c">close</a>(fd);</div>
<div class="line">     <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> <table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structadc__attr__t.html">adc_attr_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">ADC IO Attributes.  <a href="structadc__attr__t.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga555a695bf58df062dc03f0e892d95cd7"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga555a695bf58df062dc03f0e892d95cd7"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___a_d_c.html#ga555a695bf58df062dc03f0e892d95cd7">ADC_MAX</a></td></tr>
<tr class="memdesc:ga555a695bf58df062dc03f0e892d95cd7"><td class="mdescLeft">&#160;</td><td class="mdescRight">This defines the maximum value the ADC will return. It is specific to the MCU architecture. <br/></td></tr>
<tr class="separator:ga555a695bf58df062dc03f0e892d95cd7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf0098a1eafb8a60a1c65773e1064d595"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaf0098a1eafb8a60a1c65773e1064d595"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___a_d_c.html#gaf0098a1eafb8a60a1c65773e1064d595">ADC_MIN</a></td></tr>
<tr class="memdesc:gaf0098a1eafb8a60a1c65773e1064d595"><td class="mdescLeft">&#160;</td><td class="mdescRight">This defines the minimum step value of the ADC. This is MCU specific. For example if the data is not right-justified and the lowest 4 bits are always zero, ADC_MIN will be 0x10. <br/></td></tr>
<tr class="separator:gaf0098a1eafb8a60a1c65773e1064d595"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaee9ff036d0e34f634b48e953d19d3bc2"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaee9ff036d0e34f634b48e953d19d3bc2"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___a_d_c.html#gaee9ff036d0e34f634b48e953d19d3bc2">ADC_MAX_FREQ</a></td></tr>
<tr class="memdesc:gaee9ff036d0e34f634b48e953d19d3bc2"><td class="mdescLeft">&#160;</td><td class="mdescRight">This values defines the maximum frequency that can be used when reading the ADC. When doing an IOCTL write request, the freq member should not exceed this value. <br/></td></tr>
<tr class="separator:gaee9ff036d0e34f634b48e953d19d3bc2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae599932a5a540645042f364aa40335ae"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___a_d_c.html#gae599932a5a540645042f364aa40335ae">I_ADC_GETATTR</a></td></tr>
<tr class="memdesc:gae599932a5a540645042f364aa40335ae"><td class="mdescLeft">&#160;</td><td class="mdescRight">See below for details.  <a href="#gae599932a5a540645042f364aa40335ae">More...</a><br/></td></tr>
<tr class="separator:gae599932a5a540645042f364aa40335ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf9007b82aa0f9af53bbb74796462927e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___a_d_c.html#gaf9007b82aa0f9af53bbb74796462927e">I_ADC_SETATTR</a></td></tr>
<tr class="memdesc:gaf9007b82aa0f9af53bbb74796462927e"><td class="mdescLeft">&#160;</td><td class="mdescRight">See below for details.  <a href="#gaf9007b82aa0f9af53bbb74796462927e">More...</a><br/></td></tr>
<tr class="separator:gaf9007b82aa0f9af53bbb74796462927e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ga33301a686dfa6470fcd5ddae981e889f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga33301a686dfa6470fcd5ddae981e889f"></a>
typedef uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___a_d_c.html#ga33301a686dfa6470fcd5ddae981e889f">adc_sample_t</a></td></tr>
<tr class="memdesc:ga33301a686dfa6470fcd5ddae981e889f"><td class="mdescLeft">&#160;</td><td class="mdescRight">This defines the type of an ADC sample (see adc_read() and adc_write()). <br/></td></tr>
<tr class="separator:ga33301a686dfa6470fcd5ddae981e889f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="gae599932a5a540645042f364aa40335ae"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define I_ADC_GETATTR</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This requests reads the ADC attributes.</p>
<p>Example: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="adc_8h.html">dev/adc.h</a>&gt;</span></div>
<div class="line"><a class="code" href="structadc__attr__t.html">adc_attr_t</a> attr;</div>
<div class="line"><span class="keywordtype">int</span> adc_fd;</div>
<div class="line">...</div>
<div class="line">ioctl(adc_fd, <a class="code" href="group___a_d_c.html#gae599932a5a540645042f364aa40335ae">I_ADC_GETATTR</a>, &amp;attr);</div>
</div><!-- fragment --> 
</div>
</div>
<a class="anchor" id="gaf9007b82aa0f9af53bbb74796462927e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define I_ADC_SETATTR</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This requests writes the ADC attributes.</p>
<p>Example: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="adc_8h.html">dev/adc.h</a>&gt;</span></div>
<div class="line"><a class="code" href="structadc__attr__t.html">adc_attr_t</a> attr;</div>
<div class="line"><span class="keywordtype">int</span> adc_fd;</div>
<div class="line">...</div>
<div class="line">ioctl(adc_fd, <a class="code" href="group___a_d_c.html#gaf9007b82aa0f9af53bbb74796462927e">I_ADC_SETATTR</a>, &amp;attr);</div>
</div><!-- fragment --> 
</div>
</div>
</div><!-- contents -->

			</div>
		</div>
	</div>
</div>



	</div>

	<footer style="background: #344555; color: #fff;">
		<div class="container">
			<div class="row" style="margin-top: 20px; margin-bottom: 20px; ">
				<div class="col-md-12">
					<p>&copy; 2016 Stratify Labs, Inc</p>
				</div>
			</div>
		</div>
	</footer>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-75152879-1', 'stratifylabs.co');
  ga('send', 'pageview');

</script>
 </body>
</html>

