---
layout: page
title: Stratify OS Docs
page_source: Doxygen
---
{% include setup %}
<script type="text/javascript" src="doxy-boot.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="style.css" rel="stylesheet" type="text/css" />
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a>  </div>
  <div class="headertitle">
<div class="title">Serial Peripheral Interface (SPI)<div class="ingroups"><a class="el" href="group___s_t_f_y.html">Stratify OS</a> &raquo; <a class="el" href="group___i_f_a_c_e___d_e_v.html">Device Interface</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>This module implements a hardware SPI master. The chip select functionality is not part of this module and must be implemented separately. This allows the application to use the SPI bus to access multiple devices. More information about accessing peripheral IO is in the <a class="el" href="group___i_f_a_c_e___d_e_v.html">Device Interface</a> section.</p>
<p>The following is an example of how to read/write the SPI from an application:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;fcntl.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;dev/sos/spi.h&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> fd;</div><div class="line"><span class="keywordtype">char</span> buffer[32];</div><div class="line">spi_attr_t attr;</div><div class="line">fd = <a class="code" href="group___u_n_i___f_i_l_e___a_c_c_e_s_s.html#gac843f2e35e60c3bbf1da47d84306f29b">open</a>(<span class="stringliteral">&quot;/dev/spi0&quot;</span>, O_RDWR);</div><div class="line"></div><div class="line">attr.o_flags = <a class="code" href="group___s_p_i.html#gga1345813b5f798947ef33053642ed97ddac74aa61f57a88bb01266cf315be8e97c">SPI_FLAG_SET_MASTER</a> | <a class="code" href="group___s_p_i.html#gga1345813b5f798947ef33053642ed97ddaffd80b535b20edba54443437e906a464">SPI_FLAG_IS_MODE0</a> | <a class="code" href="group___s_p_i.html#gga1345813b5f798947ef33053642ed97dda7d35814556b0e3749326c685d1c0f6cb">SPI_FLAG_IS_FORMAT_SPI</a>;</div><div class="line">attr.width = 8;</div><div class="line">attr.freq = 1000000;</div><div class="line">attr.pin_assignment.mosi = mcu_pin(0,0);</div><div class="line">attr.pin_assignment.miso = mcu_pin(0,1);</div><div class="line">attr.pin_assignment.sck = mcu_pin(0,2);</div><div class="line">attr.pin_assignment.cs = mcu_pin(0xff,0xff); <span class="comment">//only used by slave</span></div><div class="line"><a class="code" href="group___u_n_i___f_i_l_e___a_c_c_e_s_s.html#ga1e7463f2ee53d9da5a2ee24121aed25d">ioctl</a>(fd, <a class="code" href="group___s_p_i.html#ga3c48de01f44d809e504b02d420ce66e2">I_SPI_SETATTR</a>, &amp;attr);</div><div class="line"></div><div class="line"><a class="code" href="group___u_n_i___f_i_l_e___a_c_c_e_s_s.html#gaefe7609d91407014d94611912cc2b1a3">read</a>(fd, buffer, 32);</div><div class="line"><a class="code" href="group___u_n_i___f_i_l_e___a_c_c_e_s_s.html#gadd30ddeed4bdbf3c96fa36970c1ca778">write</a>(fd, buffer, 32);</div><div class="line"></div><div class="line"><a class="code" href="group___u_n_i___f_i_l_e___a_c_c_e_s_s.html#gaacad1d135ca2779b583623678e36db7c">close</a>(fd);</div></div><!-- fragment --> <table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga9af95975cd0f8779447aa0c9b5918d82"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga9af95975cd0f8779447aa0c9b5918d82"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___s_p_i.html#ga9af95975cd0f8779447aa0c9b5918d82">I_SPI_GETINFO</a></td></tr>
<tr class="memdesc:ga9af95975cd0f8779447aa0c9b5918d82"><td class="mdescLeft">&#160;</td><td class="mdescRight">This request gets the SPI attributes. <br /></td></tr>
<tr class="separator:ga9af95975cd0f8779447aa0c9b5918d82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3c48de01f44d809e504b02d420ce66e2"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga3c48de01f44d809e504b02d420ce66e2"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___s_p_i.html#ga3c48de01f44d809e504b02d420ce66e2">I_SPI_SETATTR</a></td></tr>
<tr class="memdesc:ga3c48de01f44d809e504b02d420ce66e2"><td class="mdescLeft">&#160;</td><td class="mdescRight">This request sets the SPI attributes. <br /></td></tr>
<tr class="separator:ga3c48de01f44d809e504b02d420ce66e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab641415ca6596d88617661aaf2457739"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___s_p_i.html#gab641415ca6596d88617661aaf2457739">I_SPI_SWAP</a></td></tr>
<tr class="memdesc:gab641415ca6596d88617661aaf2457739"><td class="mdescLeft">&#160;</td><td class="mdescRight">See details below.  <a href="#gab641415ca6596d88617661aaf2457739">More...</a><br /></td></tr>
<tr class="separator:gab641415ca6596d88617661aaf2457739"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="gab641415ca6596d88617661aaf2457739"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define I_SPI_SWAP</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This tells the SPI bus to get a swap a byte from the bus. spi_ioctl() returns the word read from the bus; The ctl argument to spi_ioctl() is the word to put (not a pointer to spi_attr_t).</p>
<p>The following example puts 0xAC on the bus and stores whatever is read from the bus in swapped_word. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;int swapped_word;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;swapped_word = ioctl(spi_fd, I_SPI_SWAP, 0xAC);</div></div><!-- fragment --> 
</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a class="anchor" id="ga1345813b5f798947ef33053642ed97dd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group___s_p_i.html#ga1345813b5f798947ef33053642ed97dd">spi_flag_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a class="anchor" id="gga1345813b5f798947ef33053642ed97dda7d35814556b0e3749326c685d1c0f6cb"></a>SPI_FLAG_IS_FORMAT_SPI&#160;</td><td class="fielddoc">
<p>SPI Format </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="gga1345813b5f798947ef33053642ed97ddace99e504f07be46acf9b61143d68f6ff"></a>SPI_FLAG_IS_FORMAT_TI&#160;</td><td class="fielddoc">
<p>TI Format </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="gga1345813b5f798947ef33053642ed97ddabb04160604b03bc02126107726dd084a"></a>SPI_FLAG_IS_FORMAT_MICROWIRE&#160;</td><td class="fielddoc">
<p>Microwire format </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="gga1345813b5f798947ef33053642ed97ddaffd80b535b20edba54443437e906a464"></a>SPI_FLAG_IS_MODE0&#160;</td><td class="fielddoc">
<p>SPI Mode 0 </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="gga1345813b5f798947ef33053642ed97dda2f53939ea750e1e7da188b6c972f07bb"></a>SPI_FLAG_IS_MODE1&#160;</td><td class="fielddoc">
<p>SPI Mode 1 </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="gga1345813b5f798947ef33053642ed97ddacddc5aaf0f144e4be5171772d541e698"></a>SPI_FLAG_IS_MODE2&#160;</td><td class="fielddoc">
<p>SPI Mode 2 </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="gga1345813b5f798947ef33053642ed97dda81253fda7d12b0e1c5f6c4e77f7d0699"></a>SPI_FLAG_IS_MODE3&#160;</td><td class="fielddoc">
<p>SPI Mode 3 </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="gga1345813b5f798947ef33053642ed97ddac74aa61f57a88bb01266cf315be8e97c"></a>SPI_FLAG_SET_MASTER&#160;</td><td class="fielddoc">
<p>SPI Master </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="gga1345813b5f798947ef33053642ed97dda98b290b9ea223a8f9d3004bf7cd0c369"></a>SPI_FLAG_SET_SLAVE&#160;</td><td class="fielddoc">
<p>SPI Slave </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="gga1345813b5f798947ef33053642ed97dda5c04d12f91e8ffeceba64916df16d613"></a>SPI_FLAG_IS_FULL_DUPLEX&#160;</td><td class="fielddoc">
<p>Full duplex mode (data is written first then read into the same buffer) </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="gga1345813b5f798947ef33053642ed97ddaf57a97576df64360a8aa9f012d046e74"></a>SPI_FLAG_IS_HALF_DUPLEX&#160;</td><td class="fielddoc">
<p>Half duplex mode (default mode) </p>
</td></tr>
</table>

</div>
</div>
</div><!-- contents -->
<div style="background: #fff;">
	<div class="container">
		{% include signup.html %}
	</div>
</div>