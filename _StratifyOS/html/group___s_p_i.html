---
layout: page
title: Stratify OS Docs
page_source: Doxygen
---
{% include setup %}
<script type="text/javascript" src="doxy-boot.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="style.css" rel="stylesheet" type="text/css" />
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a>  </div>
  <div class="headertitle">
<div class="title">Serial Peripheral Interface (SPI)<div class="ingroups"><a class="el" href="group___s_t_f_y.html">Stratify OS</a> &raquo; <a class="el" href="group___i_f_a_c_e___d_e_v.html">Device Interface</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>This module implements a hardware SPI master. The chip select functionality is not part of this module and must be implemented separately. This allows the application to use the SPI bus to access multiple devices. More information about accessing peripheral IO is in the <a class="el" href="group___i_f_a_c_e___d_e_v.html">Device Interface</a> section.</p>
<p>The following is an example of how to read/write the SPI from an application:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;fcntl.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;dev/sos/spi.h&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> fd;</div><div class="line"><span class="keywordtype">char</span> buffer[32];</div><div class="line"><a class="code" href="structspi__attr__t.html">spi_attr_t</a> attr;</div><div class="line">fd = <a class="code" href="group___u_n_i___f_i_l_e___a_c_c_e_s_s.html#gac843f2e35e60c3bbf1da47d84306f29b">open</a>(<span class="stringliteral">&quot;/dev/spi0&quot;</span>, O_RDWR);</div><div class="line"></div><div class="line">attr.<a class="code" href="structspi__attr__t.html#a2167852a7b7feb87c0342bfdbebb20ed">o_flags</a> = <a class="code" href="group___s_p_i.html#gga1345813b5f798947ef33053642ed97ddac74aa61f57a88bb01266cf315be8e97c">SPI_FLAG_SET_MASTER</a> | <a class="code" href="group___s_p_i.html#gga1345813b5f798947ef33053642ed97ddaffd80b535b20edba54443437e906a464">SPI_FLAG_IS_MODE0</a> | <a class="code" href="group___s_p_i.html#gga1345813b5f798947ef33053642ed97dda7d35814556b0e3749326c685d1c0f6cb">SPI_FLAG_IS_FORMAT_SPI</a>;</div><div class="line">attr.<a class="code" href="structspi__attr__t.html#a190b1f3aa35b559a723658f430343b24">width</a> = 8;</div><div class="line">attr.<a class="code" href="structspi__attr__t.html#a7ee52385531b4ca6ede50cfe6dc856f3">freq</a> = 1000000;</div><div class="line">attr.<a class="code" href="structspi__attr__t.html#ae742d13bc29eeef413bc7f8179f0eb80">pin_assignment</a>.<a class="code" href="structspi__pin__assignment__t.html#ab627d132315a0db4ed918291f8ce6773">mosi</a> = mcu_pin(0,0);</div><div class="line">attr.<a class="code" href="structspi__attr__t.html#ae742d13bc29eeef413bc7f8179f0eb80">pin_assignment</a>.<a class="code" href="structspi__pin__assignment__t.html#a7153099ff27898b1e3385bcc0deac1ec">miso</a> = mcu_pin(0,1);</div><div class="line">attr.<a class="code" href="structspi__attr__t.html#ae742d13bc29eeef413bc7f8179f0eb80">pin_assignment</a>.<a class="code" href="structspi__pin__assignment__t.html#a50ccccd3a2df433779082cbc48d7718d">sck</a> = mcu_pin(0,2);</div><div class="line">attr.<a class="code" href="structspi__attr__t.html#ae742d13bc29eeef413bc7f8179f0eb80">pin_assignment</a>.<a class="code" href="structspi__pin__assignment__t.html#ac3581a3a3b094f4552adc56a386ac716">cs</a> = mcu_pin(0xff,0xff); <span class="comment">//only used by slave</span></div><div class="line"><a class="code" href="group___u_n_i___f_i_l_e___a_c_c_e_s_s.html#ga1e7463f2ee53d9da5a2ee24121aed25d">ioctl</a>(fd, <a class="code" href="group___s_p_i.html#ga3c48de01f44d809e504b02d420ce66e2">I_SPI_SETATTR</a>, &amp;attr);</div><div class="line"></div><div class="line"><a class="code" href="group___u_n_i___f_i_l_e___a_c_c_e_s_s.html#gaefe7609d91407014d94611912cc2b1a3">read</a>(fd, buffer, 32);</div><div class="line"><a class="code" href="group___u_n_i___f_i_l_e___a_c_c_e_s_s.html#gadd30ddeed4bdbf3c96fa36970c1ca778">write</a>(fd, buffer, 32);</div><div class="line"></div><div class="line"><a class="code" href="group___u_n_i___f_i_l_e___a_c_c_e_s_s.html#gaacad1d135ca2779b583623678e36db7c">close</a>(fd);</div></div><!-- fragment --><p>For full duplex operation use:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;fcntl.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;dev/sos/spi.h&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> fd;</div><div class="line"><a class="code" href="structspi__attr__t.html">spi_attr_t</a> attr;</div><div class="line">fd = <a class="code" href="group___u_n_i___f_i_l_e___a_c_c_e_s_s.html#gac843f2e35e60c3bbf1da47d84306f29b">open</a>(<span class="stringliteral">&quot;/dev/spi0&quot;</span>, O_RDWR);</div><div class="line"><span class="keywordtype">char</span> read_buffer[32];</div><div class="line"><span class="keywordtype">char</span> write_buffer[32];</div><div class="line"><span class="keyword">struct </span><a class="code" href="structaiocb.html">aiocb</a> aio;</div><div class="line"></div><div class="line"></div><div class="line">attr.<a class="code" href="structspi__attr__t.html#a2167852a7b7feb87c0342bfdbebb20ed">o_flags</a> = <a class="code" href="group___s_p_i.html#gga1345813b5f798947ef33053642ed97ddac74aa61f57a88bb01266cf315be8e97c">SPI_FLAG_SET_MASTER</a> | <a class="code" href="group___s_p_i.html#gga1345813b5f798947ef33053642ed97ddaffd80b535b20edba54443437e906a464">SPI_FLAG_IS_MODE0</a> | <a class="code" href="group___s_p_i.html#gga1345813b5f798947ef33053642ed97dda7d35814556b0e3749326c685d1c0f6cb">SPI_FLAG_IS_FORMAT_SPI</a> | <a class="code" href="group___s_p_i.html#gga1345813b5f798947ef33053642ed97dda5c04d12f91e8ffeceba64916df16d613">SPI_FLAG_IS_FULL_DUPLEX</a>;</div><div class="line">attr.<a class="code" href="structspi__attr__t.html#a190b1f3aa35b559a723658f430343b24">width</a> = 8;</div><div class="line">attr.<a class="code" href="structspi__attr__t.html#a7ee52385531b4ca6ede50cfe6dc856f3">freq</a> = 1000000;</div><div class="line">attr.<a class="code" href="structspi__attr__t.html#ae742d13bc29eeef413bc7f8179f0eb80">pin_assignment</a>.<a class="code" href="structspi__pin__assignment__t.html#ab627d132315a0db4ed918291f8ce6773">mosi</a> = mcu_pin(0,0);</div><div class="line">attr.<a class="code" href="structspi__attr__t.html#ae742d13bc29eeef413bc7f8179f0eb80">pin_assignment</a>.<a class="code" href="structspi__pin__assignment__t.html#a7153099ff27898b1e3385bcc0deac1ec">miso</a> = mcu_pin(0,1);</div><div class="line">attr.<a class="code" href="structspi__attr__t.html#ae742d13bc29eeef413bc7f8179f0eb80">pin_assignment</a>.<a class="code" href="structspi__pin__assignment__t.html#a50ccccd3a2df433779082cbc48d7718d">sck</a> = mcu_pin(0,2);</div><div class="line">attr.<a class="code" href="structspi__attr__t.html#ae742d13bc29eeef413bc7f8179f0eb80">pin_assignment</a>.<a class="code" href="structspi__pin__assignment__t.html#ac3581a3a3b094f4552adc56a386ac716">cs</a> = mcu_pin(0xff,0xff); <span class="comment">//only used by slave</span></div><div class="line"><a class="code" href="group___u_n_i___f_i_l_e___a_c_c_e_s_s.html#ga1e7463f2ee53d9da5a2ee24121aed25d">ioctl</a>(fd, <a class="code" href="group___s_p_i.html#ga3c48de01f44d809e504b02d420ce66e2">I_SPI_SETATTR</a>, &amp;attr);</div><div class="line"></div><div class="line">aio.aio_buf = read_buffer;</div><div class="line">aio.aio_nbytes = 32;</div><div class="line">aio.aio_fildes = fd;</div><div class="line"></div><div class="line">aio_read(fd, &amp;aio); <span class="comment">//this won&#39;t do anything on the bus</span></div><div class="line"><a class="code" href="group___u_n_i___f_i_l_e___a_c_c_e_s_s.html#gadd30ddeed4bdbf3c96fa36970c1ca778">write</a>(fd, write_buffer, 32); <span class="comment">//this will read to read_buffer and write from write_buffer</span></div><div class="line"></div><div class="line">printf(<span class="stringliteral">&quot;AIO return is %d\n&quot;</span>, aio_return(&amp;aio)); <span class="comment">//AIO completes when the write completes</span></div><div class="line"></div><div class="line"><a class="code" href="group___u_n_i___f_i_l_e___a_c_c_e_s_s.html#gaacad1d135ca2779b583623678e36db7c">close</a>(fd);</div></div><!-- fragment --> <table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structspi__pin__assignment__t.html">spi_pin_assignment_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">SPI Pin Assignment Data.  <a href="structspi__pin__assignment__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structspi__attr__t.html">spi_attr_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">SPI Set Attributes Data.  <a href="structspi__attr__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga9af95975cd0f8779447aa0c9b5918d82"><td class="memItemLeft" align="right" valign="top"><a id="ga9af95975cd0f8779447aa0c9b5918d82"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___s_p_i.html#ga9af95975cd0f8779447aa0c9b5918d82">I_SPI_GETINFO</a></td></tr>
<tr class="memdesc:ga9af95975cd0f8779447aa0c9b5918d82"><td class="mdescLeft">&#160;</td><td class="mdescRight">This request gets the SPI attributes. <br /></td></tr>
<tr class="separator:ga9af95975cd0f8779447aa0c9b5918d82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3c48de01f44d809e504b02d420ce66e2"><td class="memItemLeft" align="right" valign="top"><a id="ga3c48de01f44d809e504b02d420ce66e2"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___s_p_i.html#ga3c48de01f44d809e504b02d420ce66e2">I_SPI_SETATTR</a></td></tr>
<tr class="memdesc:ga3c48de01f44d809e504b02d420ce66e2"><td class="mdescLeft">&#160;</td><td class="mdescRight">This request sets the SPI attributes. <br /></td></tr>
<tr class="separator:ga3c48de01f44d809e504b02d420ce66e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab641415ca6596d88617661aaf2457739"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___s_p_i.html#gab641415ca6596d88617661aaf2457739">I_SPI_SWAP</a></td></tr>
<tr class="memdesc:gab641415ca6596d88617661aaf2457739"><td class="mdescLeft">&#160;</td><td class="mdescRight">See details below.  <a href="#gab641415ca6596d88617661aaf2457739">More...</a><br /></td></tr>
<tr class="separator:gab641415ca6596d88617661aaf2457739"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:ga1345813b5f798947ef33053642ed97dd"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___s_p_i.html#ga1345813b5f798947ef33053642ed97dd">spi_flag_t</a> { <br />
&#160;&#160;<a class="el" href="group___s_p_i.html#gga1345813b5f798947ef33053642ed97dda7d35814556b0e3749326c685d1c0f6cb">SPI_FLAG_IS_FORMAT_SPI</a>, 
<br />
&#160;&#160;<a class="el" href="group___s_p_i.html#gga1345813b5f798947ef33053642ed97ddace99e504f07be46acf9b61143d68f6ff">SPI_FLAG_IS_FORMAT_TI</a>, 
<br />
&#160;&#160;<a class="el" href="group___s_p_i.html#gga1345813b5f798947ef33053642ed97ddabb04160604b03bc02126107726dd084a">SPI_FLAG_IS_FORMAT_MICROWIRE</a>, 
<br />
&#160;&#160;<a class="el" href="group___s_p_i.html#gga1345813b5f798947ef33053642ed97ddaffd80b535b20edba54443437e906a464">SPI_FLAG_IS_MODE0</a>, 
<br />
&#160;&#160;<a class="el" href="group___s_p_i.html#gga1345813b5f798947ef33053642ed97dda2f53939ea750e1e7da188b6c972f07bb">SPI_FLAG_IS_MODE1</a>, 
<br />
&#160;&#160;<a class="el" href="group___s_p_i.html#gga1345813b5f798947ef33053642ed97ddacddc5aaf0f144e4be5171772d541e698">SPI_FLAG_IS_MODE2</a>, 
<br />
&#160;&#160;<a class="el" href="group___s_p_i.html#gga1345813b5f798947ef33053642ed97dda81253fda7d12b0e1c5f6c4e77f7d0699">SPI_FLAG_IS_MODE3</a>, 
<br />
&#160;&#160;<a class="el" href="group___s_p_i.html#gga1345813b5f798947ef33053642ed97ddac74aa61f57a88bb01266cf315be8e97c">SPI_FLAG_SET_MASTER</a>, 
<br />
&#160;&#160;<a class="el" href="group___s_p_i.html#gga1345813b5f798947ef33053642ed97dda98b290b9ea223a8f9d3004bf7cd0c369">SPI_FLAG_SET_SLAVE</a>, 
<br />
&#160;&#160;<a class="el" href="group___s_p_i.html#gga1345813b5f798947ef33053642ed97dda5c04d12f91e8ffeceba64916df16d613">SPI_FLAG_IS_FULL_DUPLEX</a>, 
<br />
&#160;&#160;<a class="el" href="group___s_p_i.html#gga1345813b5f798947ef33053642ed97ddaf57a97576df64360a8aa9f012d046e74">SPI_FLAG_IS_HALF_DUPLEX</a>, 
<br />
&#160;&#160;<a class="el" href="group___s_p_i.html#gga1345813b5f798947ef33053642ed97ddac3b7d2314338bd3f444877e94b1230fb">SPI_FLAG_IS_LSB_FIRST</a>
<br />
 }</td></tr>
<tr class="separator:ga1345813b5f798947ef33053642ed97dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="gab641415ca6596d88617661aaf2457739"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab641415ca6596d88617661aaf2457739">&#9670;&nbsp;</a></span>I_SPI_SWAP</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define I_SPI_SWAP</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This tells the SPI bus to get a swap a byte from the bus. spi_ioctl() returns the word read from the bus; The ctl argument to spi_ioctl() is the word to put (not a pointer to <a class="el" href="structspi__attr__t.html" title="SPI Set Attributes Data.">spi_attr_t</a>).</p>
<p>The following example puts 0xAC on the bus and stores whatever is read from the bus in swapped_word. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> swapped_word;</div><div class="line">swapped_word = <a class="code" href="group___u_n_i___f_i_l_e___a_c_c_e_s_s.html#ga1e7463f2ee53d9da5a2ee24121aed25d">ioctl</a>(spi_fd, <a class="code" href="group___s_p_i.html#gab641415ca6596d88617661aaf2457739">I_SPI_SWAP</a>, 0xAC);</div></div><!-- fragment --> 
</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="ga1345813b5f798947ef33053642ed97dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1345813b5f798947ef33053642ed97dd">&#9670;&nbsp;</a></span>spi_flag_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group___s_p_i.html#ga1345813b5f798947ef33053642ed97dd">spi_flag_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="gga1345813b5f798947ef33053642ed97dda7d35814556b0e3749326c685d1c0f6cb"></a>SPI_FLAG_IS_FORMAT_SPI&#160;</td><td class="fielddoc"><p>SPI Format </p>
</td></tr>
<tr><td class="fieldname"><a id="gga1345813b5f798947ef33053642ed97ddace99e504f07be46acf9b61143d68f6ff"></a>SPI_FLAG_IS_FORMAT_TI&#160;</td><td class="fielddoc"><p>TI Format </p>
</td></tr>
<tr><td class="fieldname"><a id="gga1345813b5f798947ef33053642ed97ddabb04160604b03bc02126107726dd084a"></a>SPI_FLAG_IS_FORMAT_MICROWIRE&#160;</td><td class="fielddoc"><p>Microwire format </p>
</td></tr>
<tr><td class="fieldname"><a id="gga1345813b5f798947ef33053642ed97ddaffd80b535b20edba54443437e906a464"></a>SPI_FLAG_IS_MODE0&#160;</td><td class="fielddoc"><p>SPI Mode 0 </p>
</td></tr>
<tr><td class="fieldname"><a id="gga1345813b5f798947ef33053642ed97dda2f53939ea750e1e7da188b6c972f07bb"></a>SPI_FLAG_IS_MODE1&#160;</td><td class="fielddoc"><p>SPI Mode 1 </p>
</td></tr>
<tr><td class="fieldname"><a id="gga1345813b5f798947ef33053642ed97ddacddc5aaf0f144e4be5171772d541e698"></a>SPI_FLAG_IS_MODE2&#160;</td><td class="fielddoc"><p>SPI Mode 2 </p>
</td></tr>
<tr><td class="fieldname"><a id="gga1345813b5f798947ef33053642ed97dda81253fda7d12b0e1c5f6c4e77f7d0699"></a>SPI_FLAG_IS_MODE3&#160;</td><td class="fielddoc"><p>SPI Mode 3 </p>
</td></tr>
<tr><td class="fieldname"><a id="gga1345813b5f798947ef33053642ed97ddac74aa61f57a88bb01266cf315be8e97c"></a>SPI_FLAG_SET_MASTER&#160;</td><td class="fielddoc"><p>SPI Master </p>
</td></tr>
<tr><td class="fieldname"><a id="gga1345813b5f798947ef33053642ed97dda98b290b9ea223a8f9d3004bf7cd0c369"></a>SPI_FLAG_SET_SLAVE&#160;</td><td class="fielddoc"><p>SPI Slave </p>
</td></tr>
<tr><td class="fieldname"><a id="gga1345813b5f798947ef33053642ed97dda5c04d12f91e8ffeceba64916df16d613"></a>SPI_FLAG_IS_FULL_DUPLEX&#160;</td><td class="fielddoc"><p>Full duplex mode (data must be read async when written syncronously) </p>
</td></tr>
<tr><td class="fieldname"><a id="gga1345813b5f798947ef33053642ed97ddaf57a97576df64360a8aa9f012d046e74"></a>SPI_FLAG_IS_HALF_DUPLEX&#160;</td><td class="fielddoc"><p>Half duplex mode (default mode - will be used if SPI_FLAG_IS_FULL_DUPLEX not set) </p>
</td></tr>
<tr><td class="fieldname"><a id="gga1345813b5f798947ef33053642ed97ddac3b7d2314338bd3f444877e94b1230fb"></a>SPI_FLAG_IS_LSB_FIRST&#160;</td><td class="fielddoc"><p>LSB first (non-standard) </p>
</td></tr>
</table>

</div>
</div>
</div><!-- contents -->
<div style="background: #fff;">
	<div class="container">
		{% include signup.html %}
	</div>
</div>