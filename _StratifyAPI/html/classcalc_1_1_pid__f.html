---
layout: page
title: Stratify OS Docs
page_source: Doxygen
---
{% include JB/setup %}
<script type="text/javascript" src="doxy-boot.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="style.css" rel="stylesheet" type="text/css" />
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacecalc.html">calc</a></li><li class="navelem"><a class="el" href="classcalc_1_1_pid__f.html">Pid_f</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="classcalc_1_1_pid__f-members.html">List of all members</a> &#124;
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">calc::Pid_f Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Documentation</h2>
<div class="textblock"><p>This class implements a PID control loop using floating point values.</p>
<p>A PID control loop uses three constant values in order to calculate a control variable such that the input converges on the target variable.</p>
<p>The following terminology is used in this documentation.</p>
<ul>
<li>kp: Proportional constant</li>
<li>ki: Integral constant</li>
<li>kd: Differential constant</li>
<li>present value: the current value of the system output</li>
<li>target variable: desired output value of the system</li>
<li>control variable: calculated value to apply such that the input tends to the target variable</li>
<li>error variable: the error variable is the difference between the target variable and the present value</li>
</ul>
<p>An example for using a PID control loop is temperature control. Consider a system that uses a PWM value to heat an element and a temperature sensor to read the output. The above terminology is applied as follows:</p>
<ul>
<li>kp: Value selected by the developer to tune the control loop</li>
<li>ki: Value selected by the developer to tune the control loop</li>
<li>kd: Value selected by the developer to tune the control loop</li>
<li>present value: the value of the temperature sensor output</li>
<li>target variable: the desired temperature sensor output</li>
<li>control variable: the PWM duty cycle that should be applied to the heater</li>
<li>error variable: the different between the desired temperature output and the present temperature output</li>
</ul>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;sapi/calc.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sapi/hal.hpp&gt;</span></div><div class="line"></div><div class="line"><a class="code" href="classcalc_1_1_pid__f.html#abd17ca5d245bfff577c9333b6c80784a">Pid_f</a> pid_loop;</div><div class="line">Pwm control(0);</div><div class="line">Adc present_value(0);</div><div class="line">u16 adc_value;</div><div class="line"></div><div class="line"><span class="keyword">volatile</span> <span class="keywordtype">bool</span> is_active = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">pid_loop.set_kp(1.0);</div><div class="line">pid_loop.set_ki(0.1);</div><div class="line">pid_loop.set_kd(0.001);</div><div class="line">pid_loop.set_maximum(1000); <span class="comment">//max duty cycle</span></div><div class="line">pid_loop.set_minimum(0); <span class="comment">//min duty cycle</span></div><div class="line"></div><div class="line"> <span class="comment">//Init the PWM output and ADC input</span></div><div class="line"></div><div class="line"><span class="keywordflow">while</span>( is_active ){</div><div class="line"> present_value.read(0, &amp;adc_value, 2);</div><div class="line">  control.set_duty( pid_looop.calc_control_variable( 3.3 * adc_value / 4096 ) );</div><div class="line">}</div></div><!-- fragment --> </div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a4273dcf5f55c50c34096d7981f3fea91"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcalc_1_1_pid__f.html#a4273dcf5f55c50c34096d7981f3fea91">calc_control_variable</a> (float present_value)</td></tr>
<tr class="separator:a4273dcf5f55c50c34096d7981f3fea91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4c58171664152d273947f41de11f5f5"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcalc_1_1_pid__f.html#ad4c58171664152d273947f41de11f5f5">kd</a> () const </td></tr>
<tr class="separator:ad4c58171664152d273947f41de11f5f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abae605b5adab4a292ad4572958379b33"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcalc_1_1_pid__f.html#abae605b5adab4a292ad4572958379b33">ki</a> () const </td></tr>
<tr class="separator:abae605b5adab4a292ad4572958379b33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba1d03ee4920df8a139a4cc0a2dc25cf"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcalc_1_1_pid__f.html#aba1d03ee4920df8a139a4cc0a2dc25cf">kp</a> () const </td></tr>
<tr class="separator:aba1d03ee4920df8a139a4cc0a2dc25cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a39a6049711dfa3010797398cbc12ff"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcalc_1_1_pid__f.html#a8a39a6049711dfa3010797398cbc12ff">max</a> () const </td></tr>
<tr class="separator:a8a39a6049711dfa3010797398cbc12ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4901edc217e747152bc2a35b73990f04"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcalc_1_1_pid__f.html#a4901edc217e747152bc2a35b73990f04">min</a> () const </td></tr>
<tr class="separator:a4901edc217e747152bc2a35b73990f04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd17ca5d245bfff577c9333b6c80784a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcalc_1_1_pid__f.html#abd17ca5d245bfff577c9333b6c80784a">Pid_f</a> (float <a class="el" href="classcalc_1_1_pid__f.html#a28b6ac4a82ccd56e3634b7f9ac808678">target</a>=0.0, float <a class="el" href="classcalc_1_1_pid__f.html#aba1d03ee4920df8a139a4cc0a2dc25cf">kp</a>=1.0, float <a class="el" href="classcalc_1_1_pid__f.html#abae605b5adab4a292ad4572958379b33">ki</a>=0.1, float <a class="el" href="classcalc_1_1_pid__f.html#ad4c58171664152d273947f41de11f5f5">kd</a>=0.0, float <a class="el" href="classcalc_1_1_pid__f.html#a4901edc217e747152bc2a35b73990f04">min</a>=1.0, float <a class="el" href="classcalc_1_1_pid__f.html#a8a39a6049711dfa3010797398cbc12ff">max</a>=0.0)</td></tr>
<tr class="separator:abd17ca5d245bfff577c9333b6c80784a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c8b7411ab08449f17c96c6b466bcfd7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcalc_1_1_pid__f.html#a2c8b7411ab08449f17c96c6b466bcfd7">reset</a> ()</td></tr>
<tr class="separator:a2c8b7411ab08449f17c96c6b466bcfd7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aedb0786fdc805b214904f93e57819ac1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcalc_1_1_pid__f.html#aedb0786fdc805b214904f93e57819ac1">set_kd</a> (float v)</td></tr>
<tr class="separator:aedb0786fdc805b214904f93e57819ac1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a900f58c7ec4e42a6c39f81266b607fb4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcalc_1_1_pid__f.html#a900f58c7ec4e42a6c39f81266b607fb4">set_ki</a> (float v)</td></tr>
<tr class="separator:a900f58c7ec4e42a6c39f81266b607fb4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f81493e93bd6def8723872922ab2f3f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcalc_1_1_pid__f.html#a2f81493e93bd6def8723872922ab2f3f">set_kp</a> (float v)</td></tr>
<tr class="separator:a2f81493e93bd6def8723872922ab2f3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7a7ccca66d37e5ac830235c5b819b48"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcalc_1_1_pid__f.html#ad7a7ccca66d37e5ac830235c5b819b48">set_max</a> (float v)</td></tr>
<tr class="separator:ad7a7ccca66d37e5ac830235c5b819b48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a047b4571b7ed3676b65021aa1cb36748"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcalc_1_1_pid__f.html#a047b4571b7ed3676b65021aa1cb36748">set_min</a> (float v)</td></tr>
<tr class="separator:a047b4571b7ed3676b65021aa1cb36748"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af79f33484fde3d658038f5bc36bc843b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcalc_1_1_pid__f.html#af79f33484fde3d658038f5bc36bc843b">set_target</a> (float v)</td></tr>
<tr class="separator:af79f33484fde3d658038f5bc36bc843b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28b6ac4a82ccd56e3634b7f9ac808678"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcalc_1_1_pid__f.html#a28b6ac4a82ccd56e3634b7f9ac808678">target</a> () const </td></tr>
<tr class="separator:a28b6ac4a82ccd56e3634b7f9ac808678"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="abd17ca5d245bfff577c9333b6c80784a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">calc::Pid_f::Pid_f </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>target</em> = <code>0.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>kp</em> = <code>1.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>ki</em> = <code>0.1</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>kd</em> = <code>0.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>min</em> = <code>1.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>max</em> = <code>0.0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Constructs a new PID (float) object.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">target</td><td>The target value </td></tr>
    <tr><td class="paramname">kp</td><td>The proportional constant </td></tr>
    <tr><td class="paramname">ki</td><td>The integral constant </td></tr>
    <tr><td class="paramname">kd</td><td>The differential constant </td></tr>
    <tr><td class="paramname">min</td><td>The minimum value for the calculated control value </td></tr>
    <tr><td class="paramname">max</td><td>The maximum value for the calculated control value </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a4273dcf5f55c50c34096d7981f3fea91"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float calc::Pid_f::calc_control_variable </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>present_value</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Calculates the control variable based on the current state of the system.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">present_value</td><td>The present value of the system </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The updated control variable to be applied to the system </dd></dl>

</div>
</div>
<a class="anchor" id="ad4c58171664152d273947f41de11f5f5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float calc::Pid_f::kd </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Returns the differential constant. </p>

</div>
</div>
<a class="anchor" id="abae605b5adab4a292ad4572958379b33"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float calc::Pid_f::ki </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Returns the integral constant. </p>

</div>
</div>
<a class="anchor" id="aba1d03ee4920df8a139a4cc0a2dc25cf"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float calc::Pid_f::kp </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Returns the proportional constant. </p>

</div>
</div>
<a class="anchor" id="a8a39a6049711dfa3010797398cbc12ff"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float calc::Pid_f::max </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Returns the maximum value for the control variable. </p>

</div>
</div>
<a class="anchor" id="a4901edc217e747152bc2a35b73990f04"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float calc::Pid_f::min </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Returns the minimum value for the control variable. </p>

</div>
</div>
<a class="anchor" id="a2c8b7411ab08449f17c96c6b466bcfd7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void calc::Pid_f::reset </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Resets the state of the PID control loop. </p>

</div>
</div>
<a class="anchor" id="aedb0786fdc805b214904f93e57819ac1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void calc::Pid_f::set_kd </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>v</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Sets the differential constant value. </p>

</div>
</div>
<a class="anchor" id="a900f58c7ec4e42a6c39f81266b607fb4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void calc::Pid_f::set_ki </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>v</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Sets the integral constant value. </p>

</div>
</div>
<a class="anchor" id="a2f81493e93bd6def8723872922ab2f3f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void calc::Pid_f::set_kp </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>v</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Sets the proportional constant value. </p>

</div>
</div>
<a class="anchor" id="ad7a7ccca66d37e5ac830235c5b819b48"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void calc::Pid_f::set_max </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>v</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Sets the maximum allowed value of the target variable. </p>

</div>
</div>
<a class="anchor" id="a047b4571b7ed3676b65021aa1cb36748"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void calc::Pid_f::set_min </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>v</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Sets the minimum allowed value of the target variable. </p>

</div>
</div>
<a class="anchor" id="af79f33484fde3d658038f5bc36bc843b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void calc::Pid_f::set_target </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>v</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Sets the value for the target variable. </p>

</div>
</div>
<a class="anchor" id="a28b6ac4a82ccd56e3634b7f9ac808678"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float calc::Pid_f::target </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Returns the target variable. </p>

</div>
</div>
</div><!-- contents -->
<div style="background: #fff;">
	<div class="container">
		{% include themes/twitter/signup.html %}
	</div>
</div>