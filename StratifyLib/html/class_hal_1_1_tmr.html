---
layout: doc_page
title: Stratify OS Docs
---
{% include JB/setup %}
<script type="text/javascript" src="doxy-boot.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="style.css" rel="stylesheet" type="text/css" />
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespace_hal.html">Hal</a></li><li class="navelem"><a class="el" href="class_hal_1_1_tmr.html">Tmr</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="class_hal_1_1_tmr-members.html">List of all members</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">Hal::Tmr Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Inheritance diagram for Hal::Tmr:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_hal_1_1_tmr__inherit__graph.svg" width="115" height="691"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<a name="details" id="details"></a><h2 class="groupheader">Documentation</h2>
<div class="textblock"><p>This class implements a hardware timer. The Timer class implements a logical timer that is based on the system clock and can be used for many timing functions.</p>
<p>The <a class="el" href="class_hal_1_1_tmr.html" title="Tmr (hardware timer) Class. ">Tmr</a> class can be used to configure a timer to count rising edges on an input capture pin or to generate waveforms on an output compare pin. It can also configure the timer to use the internal CPU clock at various frequencies.</p>
<p>For example this will start a microsecond timer (1Mhz) using an internal clock:</p>
<div class="fragment"><div class="line">Tmr tmr(0); <span class="comment">//use /dev/tmr0</span></div><div class="line">tmr.init(); <span class="comment">//the default is 1MHz clock using the CPU see init() below</span></div><div class="line">tmr.set(0); <span class="comment">//set the value to zero</span></div><div class="line">tmr.on(); <span class="comment">//turn the timer on</span></div><div class="line">Timer::wait_msec(100);</div><div class="line">printf(<span class="stringliteral">&quot;My timer value is %d\n&quot;</span>, tmr.value()); <span class="comment">//The value will be about 100,000</span></div></div><!-- fragment --><p>Here is an example using the <a class="el" href="class_hal_1_1_tmr.html" title="Tmr (hardware timer) Class. ">Tmr</a> to count external edges on input capture 0</p>
<div class="fragment"><div class="line">Tmr tmr(0);</div><div class="line">tmr.init(0, <span class="comment">//frequency is ignored in this case</span></div><div class="line">     <a class="code" href="class_hal_1_1_tmr.html#a32f3872fe162ceab2445e021c3d63cd9a6bc26358feab21840fe2d48c3e104d6d">Tmr::INPUT0</a>|<a class="code" href="class_hal_1_1_tmr.html#a32f3872fe162ceab2445e021c3d63cd9ae6bd7cfdcf1a36fef7557d597fe6a43d">Tmr::RISING</a>, <span class="comment">//use input capture channel 0 rising edges as the clock source</span></div><div class="line">     __TMR0_PINASSIGN_PORT1_26_27_28_29, <span class="comment">//This is for the LPC17xx to use P1.26 for CAP0.0 (timer0/input0)</span></div><div class="line">     0, <span class="comment">//not using output compare channels</span></div><div class="line">     0); <span class="comment">//not using input capture (other than clock source)</span></div><div class="line">tmr.on();</div><div class="line"> <span class="comment">//Tmr0 is now counting edges arriving on P1.26 (CAP0.0) for LPC17xx devices</span></div><div class="line">printf(<span class="stringliteral">&quot;Received %d edges\n&quot;</span>, tmr.value()); <span class="comment">//show the number of edges that have arrived</span></div></div><!-- fragment --><p>You can also use the output compare channels to set the top value of the timer.</p>
<div class="fragment"><div class="line">Tmr tmr(0);</div><div class="line">tmr.init(); <span class="comment">//use default settings (1MHz CPU timer)</span></div><div class="line"></div><div class="line">tmr.setaction(0,</div><div class="line">     <a class="code" href="class_hal_1_1_tmr.html#aad23d57627a26d7cddaf58c5509cdaf2a6a5910eed9b62c6a9f9891a5b78b0ff7">Tmr::RESET</a>); <span class="comment">//reset the timer to zero when the event happens</span></div><div class="line">     <span class="comment">//Now assign a value to output compare channel 0</span></div><div class="line">tmr.setoc(0, <span class="comment">//we are using output compare channel 0</span></div><div class="line">     1000000 <span class="comment">//When the count gets to 1 million (1 second at 1MHz), reset the timer</span></div><div class="line">     );</div><div class="line">tmr.on();</div></div><!-- fragment --> </div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="inherit_header pub_types_class_hal_1_1_phy"><td colspan="2" onclick="javascript:toggleInherit('pub_types_class_hal_1_1_phy')"><img src="closed.png" alt="-"/>&#160;Public Types inherited from <a class="el" href="class_hal_1_1_phy.html">Hal::Phy</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ac420fd0320f3c211c554fefb4a2047ea"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hal_1_1_tmr.html#ac420fd0320f3c211c554fefb4a2047ea">open</a> (int flags=0)</td></tr>
<tr class="separator:ac420fd0320f3c211c554fefb4a2047ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8fd1587e76cdd417e815383d23dea7ff"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hal_1_1_tmr.html#a8fd1587e76cdd417e815383d23dea7ff">setattr</a> (uint32_t <a class="elRef" doxygen="/Users/tgil/git/StratifyLabs.github.io/StratifyOS/html/StratifyOS.tag:../../StratifyOS/html/" href="../../StratifyOS/html/group___m_l_c_d.html#ga8b9e4c2db3e8e3037740abc6006e99c1">freq</a>, uint8_t clksrc=<a class="elRef" doxygen="/Users/tgil/git/StratifyLabs.github.io/StratifyOS/html/StratifyOS.tag:../../StratifyOS/html/" href="../../StratifyOS/html/group___t_m_r.html#gga752e581dd80394311e122634680ece35a6928b4e5c83b959e37e3920a09123b35">TMR_CLKSRC_CPU</a>, uint8_t pin_assign=0, uint8_t enabled_oc_chans=0, uint8_t enabled_ic_chans=0)</td></tr>
<tr class="separator:a8fd1587e76cdd417e815383d23dea7ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a19979b7aae0c81fbc2c19db42aca4bfc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hal_1_1_tmr.html#a19979b7aae0c81fbc2c19db42aca4bfc">init</a> (uint32_t <a class="elRef" doxygen="/Users/tgil/git/StratifyLabs.github.io/StratifyOS/html/StratifyOS.tag:../../StratifyOS/html/" href="../../StratifyOS/html/group___m_l_c_d.html#ga8b9e4c2db3e8e3037740abc6006e99c1">freq</a>=1000000, uint8_t clksrc=<a class="elRef" doxygen="/Users/tgil/git/StratifyLabs.github.io/StratifyOS/html/StratifyOS.tag:../../StratifyOS/html/" href="../../StratifyOS/html/group___t_m_r.html#gga752e581dd80394311e122634680ece35a6928b4e5c83b959e37e3920a09123b35">TMR_CLKSRC_CPU</a>, uint8_t pin_assign=0, uint8_t enabled_oc_chans=0, uint8_t enabled_ic_chans=0)</td></tr>
<tr class="separator:a19979b7aae0c81fbc2c19db42aca4bfc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_class_hal_1_1_periph"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_class_hal_1_1_periph')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="class_hal_1_1_periph.html">Hal::Periph</a></td></tr>
<tr class="memitem:a8c924f02938888935ac8952d6b96ec8b inherit pub_methods_class_hal_1_1_periph"><td class="memItemLeft" align="right" valign="top">virtual int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hal_1_1_periph.html#a8c924f02938888935ac8952d6b96ec8b">close</a> ()</td></tr>
<tr class="separator:a8c924f02938888935ac8952d6b96ec8b inherit pub_methods_class_hal_1_1_periph"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Member Enumeration Documentation</h2>
<a class="anchor" id="aad23d57627a26d7cddaf58c5509cdaf2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>These are the events associated with timer actions. </p>
<p>This lists the values for the event when using <a class="el" href="class_hal_1_1_tmr.html#a0030b0f171d3f73e3570ad2db30f3b14" title="Set the TMR action. ">setaction()</a>. The values can be Or'd (|) together such as <a class="el" href="class_hal_1_1_tmr.html#aad23d57627a26d7cddaf58c5509cdaf2a6a5910eed9b62c6a9f9891a5b78b0ff7">Tmr::RESET</a>|Tmr::INTERRUPT. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a class="anchor" id="aad23d57627a26d7cddaf58c5509cdaf2a140ef26fde22fa526457bdaa79bd11be"></a>INTERRUPT&#160;</td><td class="fielddoc">
<p>Trigger interrupt and execute callback </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="aad23d57627a26d7cddaf58c5509cdaf2a6a5910eed9b62c6a9f9891a5b78b0ff7"></a>RESET&#160;</td><td class="fielddoc">
<p>Reset timer value to zero </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="aad23d57627a26d7cddaf58c5509cdaf2a653abd6e443f9fe40b21bca8d0794896"></a>STOP&#160;</td><td class="fielddoc">
<p>Stop the timer </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="aad23d57627a26d7cddaf58c5509cdaf2ac6bcec69b7a025025eb6c4693c4d7e23"></a>SETOC&#160;</td><td class="fielddoc">
<p>Set the output compare pin high </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="aad23d57627a26d7cddaf58c5509cdaf2ada5e9fe9792e5ceb4949b0e93823df73"></a>CLROC&#160;</td><td class="fielddoc">
<p>Clear the output compare pin </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="aad23d57627a26d7cddaf58c5509cdaf2a8084edaf9a979cceec2103d3e8ac530c"></a>TOGGLEOC&#160;</td><td class="fielddoc">
<p>Toggle the output compare pin </p>
</td></tr>
</table>

</div>
</div>
<a class="anchor" id="a32f3872fe162ceab2445e021c3d63cd9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>List of timer clock sources. </p>
<p>This is a list of the timer clock sources. Not all clock sources are available on all devices. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a class="anchor" id="a32f3872fe162ceab2445e021c3d63cd9aa618f926277a71de972a3ab4bb5f32ec"></a>CPU&#160;</td><td class="fielddoc">
<p>Use the internal CPU clock </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a32f3872fe162ceab2445e021c3d63cd9a6bc26358feab21840fe2d48c3e104d6d"></a>INPUT0&#160;</td><td class="fielddoc">
<p>Use input 0 (device specific) </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a32f3872fe162ceab2445e021c3d63cd9aabf83d11ec826196b71f35b621e6bed7"></a>INPUT1&#160;</td><td class="fielddoc">
<p>Use input 1 (device specific) </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a32f3872fe162ceab2445e021c3d63cd9a128778c65fe9bd2ccbf715c382ea70e0"></a>INPUT2&#160;</td><td class="fielddoc">
<p>Use input 2 (device specific) </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a32f3872fe162ceab2445e021c3d63cd9a027cd2140ad5477e9955dd021519adf9"></a>INPUT3&#160;</td><td class="fielddoc">
<p>Use input 3 (device specific) </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a32f3872fe162ceab2445e021c3d63cd9ae6bd7cfdcf1a36fef7557d597fe6a43d"></a>RISING&#160;</td><td class="fielddoc">
<p>Modifier to clock on rising edges </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a32f3872fe162ceab2445e021c3d63cd9a40f2e66034a1f46c0e7be2ac99a7a36d"></a>FALLING&#160;</td><td class="fielddoc">
<p>Modifier to clock on falling edges </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a32f3872fe162ceab2445e021c3d63cd9afe98a6bd521428889c7328c0a032a543"></a>BOTH&#160;</td><td class="fielddoc">
<p>Modifier to clock on both rising and falling edges </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a32f3872fe162ceab2445e021c3d63cd9a70b7ad7b404b6fd28c9da9d984cda9fd"></a>COUNTDOWN&#160;</td><td class="fielddoc">
<p>Modifier for a countdown timer </p>
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a19979b7aae0c81fbc2c19db42aca4bfc"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int Hal::Tmr::init </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>freq</em> = <code>1000000</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>clksrc</em> = <code><a class="elRef" doxygen="/Users/tgil/git/StratifyLabs.github.io/StratifyOS/html/StratifyOS.tag:../../StratifyOS/html/" href="../../StratifyOS/html/group___t_m_r.html#gga752e581dd80394311e122634680ece35a6928b4e5c83b959e37e3920a09123b35">TMR_CLKSRC_CPU</a></code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>pin_assign</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>enabled_oc_chans</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>enabled_ic_chans</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Open TMR and set attributes as specified. </p>
<p>This opens and sets the timer attributes </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">freq</td><td>timer frequency (if using TMR_CLKSRC_CPU) </td></tr>
    <tr><td class="paramname">clksrc</td><td>clock source for the timer (default is <a class="el" href="class_hal_1_1_tmr.html#a32f3872fe162ceab2445e021c3d63cd9aa618f926277a71de972a3ab4bb5f32ec">Tmr::CPU</a>) </td></tr>
    <tr><td class="paramname">pin_assign</td><td>The pin assignment if using input capture (including clock source) or output compare pins </td></tr>
    <tr><td class="paramname">enabled_oc_chans</td><td>Mask of the enabled output compare channels (only if external pins are used) </td></tr>
    <tr><td class="paramname">enabled_ic_chans</td><td>Mask of the enabled input capture channels (only if external pins are used&ndash;not including clock source) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ac420fd0320f3c211c554fefb4a2047ea"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int Hal::Tmr::open </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em> = <code>0</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>See details below. </p>
<p>This method opens the peripheral. For each instance, the peripheral only needs to be opened one time. The port is typically opened with <a class="el" href="class_hal_1_1_tmr.html#ac420fd0320f3c211c554fefb4a2047ea" title="See details below. ">open()</a> and configured with <a class="el" href="class_hal_1_1_tmr.html#a7314612c42db94035134ca409d48ef31" title="Set the TMR attributes. ">setattr()</a>. After that, other instances of the peripheral can read and write without opening again. </p>

<p>Reimplemented from <a class="el" href="class_hal_1_1_periph.html#aba2031de6b193c4f8786235b927fd391">Hal::Periph</a>.</p>

</div>
</div>
<a class="anchor" id="aded6be28d52a9295a228e923357a6816"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int Hal::Tmr::setaction </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mcu_callback_t&#160;</td>
          <td class="paramname"><em>callback</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>context</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set the TMR action. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">channel</td><td>The channel to use </td></tr>
    <tr><td class="paramname">event</td><td>The event such as <a class="el" href="class_hal_1_1_tmr.html#aad23d57627a26d7cddaf58c5509cdaf2a140ef26fde22fa526457bdaa79bd11be">Tmr::INTERRUPT</a> </td></tr>
    <tr><td class="paramname">callback</td><td>Callback executed if <a class="el" href="class_hal_1_1_tmr.html#aad23d57627a26d7cddaf58c5509cdaf2a140ef26fde22fa526457bdaa79bd11be">Tmr::INTERRUPT</a> is used </td></tr>
    <tr><td class="paramname">context</td><td>First argument passed to callback </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a8fd1587e76cdd417e815383d23dea7ff"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int Hal::Tmr::setattr </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>freq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>clksrc</em> = <code><a class="elRef" doxygen="/Users/tgil/git/StratifyLabs.github.io/StratifyOS/html/StratifyOS.tag:../../StratifyOS/html/" href="../../StratifyOS/html/group___t_m_r.html#gga752e581dd80394311e122634680ece35a6928b4e5c83b959e37e3920a09123b35">TMR_CLKSRC_CPU</a></code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>pin_assign</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>enabled_oc_chans</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>enabled_ic_chans</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set the TMR attributes using specified values. </p>
<p>See <a class="el" href="class_hal_1_1_tmr.html#a19979b7aae0c81fbc2c19db42aca4bfc" title="Open TMR and set attributes as specified. ">init()</a> for details. </p>

</div>
</div>
</div><!-- contents -->
